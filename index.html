<html>
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Psychological Assistant</title>
<link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />

<style>
body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
}

.chat-container {
    width: 100%;
    max-width: 400px;
    height: 600px;
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.chat-header {
    background-color: #4CAF50;
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 1.2em;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
}

.chat-box {
    flex-grow: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

.message {
    padding: 10px 15px;
    border-radius: 20px;
    margin-bottom: 10px;
    max-width: 80%;
    word-wrap: break-word;
}

.user-message {
    background-color: #e0f7fa;
    align-self: flex-end;
}

.bot-message {
    background-color: #f1f1f1;
    align-self: flex-start;
}

.chat-input-form {
    display: flex;
    padding: 10px;
    border-top: 1px solid #ddd;
}

.chat-input-form input {
    flex-grow: 1;
    border: 1px solid #ccc;
    border-radius: 20px;
    padding: 10px 15px;
    font-size: 1em;
    outline: none;
}

.chat-input-form button {
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 10px 20px;
    margin-left: 10px;
    cursor: pointer;
    font-size: 1em;
}
</style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h3>Aadhaar AI Assistant</h3>
        </div>
        <div class="chat-box" id="chat-box">
            </div>
        <form id="chat-form" class="chat-input-form">
            <input type="text" id="user-input" placeholder="Type a message..." required>
            <button type="submit">Send</button>
        </form>
    </div>
</body>
<script>
	document.addEventListener('DOMContentLoaded', () => {
    const chatForm = document.getElementById('chat-form');
    const userInput = document.getElementById('user-input');
    const chatBox = document.getElementById('chat-box');
    const webhookUrl = 'https://jaideep2404.app.n8n.cloud/webhook/33fb3d28-1c39-4ccf-b4c5-04b45a09cf33';

    addMessage('Hi. I\'m Aadhaar. I\'m here to offer some quick support and guidance based on a structured guide. I can be a safe space to talk and find some immediate coping tips. What\'s on your mind today?', 'bot');

    chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const message = userInput.value.trim();
        if (message === '') return;

        addMessage(message, 'user');
        userInput.value = '';

        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 60000); // Increased timeout to 60 seconds

        try {
            const response = await fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: message }),
                signal: controller.signal // Correctly passes the signal
            });

            clearTimeout(timeoutId);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            const botResponse = data.output || "I'm sorry, I didn't receive a valid response. Please try again.";

            addMessage(botResponse, 'bot');
            chatBox.scrollTop = chatBox.scrollHeight;

        } catch (error) {
            clearTimeout(timeoutId);
            // This is the crucial check to handle timeouts correctly
            if (error.name === 'AbortError') {
                console.error('Request timed out on the client side.');
                addMessage("I'm sorry, that took too long. Could you try asking again in a different way?", 'bot');
            } else {
                console.error('Error fetching from n8n:', error);
                addMessage("I'm having trouble connecting to my service. Please try again in a bit.", 'bot');
            }
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    });

    function addMessage(text, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', `${sender}-message`);
        messageDiv.textContent = text;
        chatBox.appendChild(messageDiv);
    }
});
</script>
</html>




