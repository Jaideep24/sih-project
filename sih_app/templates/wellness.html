<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wellness Hub | Resources & Games</title>
  <style>
    :root{--bg:#fbfdff;--card:#fff;--ink:#0f2238;--muted:#58708d;--primary:#6c7bff;--p2:#9b8cff;--good:#22c55e;--warn:#f59e0b;--shadow:0 10px 30px rgba(15,34,56,.08);--radius:14px}
    html,body{margin:0;color:var(--ink);font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial}
    body{background:linear-gradient(180deg,#f6f8ff,#fff)}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:0 20px}
    header{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.7);backdrop-filter: blur(10px);border-bottom:1px solid #eef2ff}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--p2));box-shadow:var(--shadow)}
    nav ul{display:flex;gap:14px;list-style:none;margin:0;padding:0}
    nav a{padding:8px 12px;border-radius:10px;color:var(--muted)}
    nav a:hover, nav a.active{background:#eef2ff;color:var(--ink)}

    .tabs{display:flex;gap:10px;flex-wrap:wrap;margin:20px 0}
    .tab{border:1px solid #e5e7eb;background:#fff;padding:10px 14px;border-radius:999px;cursor:pointer}
    .tab.active{background:linear-gradient(135deg,var(--primary),var(--p2));color:#fff;border-color:transparent}

    .panel{display:none}
    .panel.active{display:block}

    .card{background:var(--card);border:1px solid #eef2ff;border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    iframe{width:100%;aspect-ratio:16/9;border:0;border-radius:12px}

    #breath{display:grid;place-items:center;padding:20px}
    .circle{width:160px;height:160px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #ffffff, #c7d2fe);box-shadow:0 0 0 8px rgba(108,123,255,.25), var(--shadow);transform:scale(1);transition: transform .8s ease-in-out}
    .hud{display:grid;gap:6px;justify-items:center;margin-top:10px}
    .hud small{color:var(--muted)}
    .big{display:inline-block;margin-top:10px;padding:14px 18px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;cursor:pointer;font-weight:800}
    .score{display:flex;gap:12px;justify-content:center;font-weight:700}
    .badge{padding:4px 10px;border-radius:999px;background:#eef2ff}
    .good{background:rgba(34,197,94,.15);color:#065f46}
    .warn{background:rgba(245,158,11,.15);color:#7c2d12}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    @media(max-width: 900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand"><div class="logo"></div><span>CampusCare</span></div>
      <nav aria-label="Primary">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/support/">Support Hub</a></li>
          <li><a class="active" href="/wellness/">Wellness Hub</a></li>
          <li><a href="/peer/">Peer Support</a></li>
          <li><a href="/myspace/">My Space</a></li>
          <li><a href="/admin/">Admin</a></li>
          <li><a href="/login/">Login</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="tabs" role="tablist">
      <button class="tab active" data-tab="videos" role="tab" aria-selected="true">Videos</button>
      <button class="tab" data-tab="audio" role="tab">Relaxation Audio</button>
      <button class="tab" data-tab="resources" role="tab">Articles & Guides</button>
      <button class="tab" data-tab="game" role="tab">Breathing Game</button>
    </div>

    <section id="videos" class="panel active" role="tabpanel">
      <div class="card">
        <h2 style="margin:0 0 8px">Mindful Breathing</h2>
        <p style="margin:0 0 12px;color:var(--muted)">A calming 5‚Äëminute practice.</p>
        <iframe src="https://www.youtube.com/embed/inpok4MKVLM" title="Mindful Breathing Video" allowfullscreen></iframe>
      </div>
    </section>

    <section id="audio" class="panel" role="tabpanel">
      <div class="card">
        <h2 style="margin:0 0 8px">Relaxation Track</h2>
        <p style="margin:0 0 12px;color:var(--muted)">Press play and take a few slow breaths.</p>
        <audio controls src="https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3"></audio>
      </div>
    </section>

    <section id="resources" class="panel" role="tabpanel">
      <div class="grid">
        <article class="card">
          <h3 style="margin:0 0 6px">Exam Focus Guide</h3>
          <p style="margin:0 0 10px;color:var(--muted)">Step-by-step plan for the week before exams.</p>
          <a href="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" target="_blank" rel="noopener" class="tab">Download PDF</a>
        </article>
        <article class="card">
          <h3 style="margin:0 0 6px">Sleep Hygiene</h3>
          <p style="margin:0 0 10px;color:var(--muted)">Evening routine tips for better rest.</p>
          <a href="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" target="_blank" rel="noopener" class="tab">Download PDF</a>
        </article>
      </div>
    </section>

    <section id="game" class="panel" role="tabpanel">
      <div class="card" id="breath">
        <h2 style="margin:0 0 6px">Breathing Game</h2>
        <p style="margin:0 12px 8px;color:var(--muted);text-align:center">Tap on phase changes (Inhale ‚Üí Hold ‚Üí Exhale). Accurate taps earn points. 6 cycles total.</p>
        <div class="circle" id="circle" aria-label="Breathing circle"></div>
        <div class="hud">
          <div class="score"><span class="badge" id="state">Ready</span><span class="badge" id="cycle">0/6</span><span class="badge" id="score">0 pts</span></div>
          <div id="feedback" class="badge" style="display:none"></div>
          <div style="display:flex;gap:10px">
            <button id="start" class="tab" style="font-weight:700">Start</button>
            <button id="stop" class="tab">Stop</button>
            <button id="tap" class="big">Tap</button>
          </div>
          <small>Tip: Try to tap right when the phase text changes.</small>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Tabs
    const tabs = document.querySelectorAll('.tab[data-tab]');
    const panels = document.querySelectorAll('.panel');
    tabs.forEach(t=> t.addEventListener('click', ()=>{
      tabs.forEach(x=>x.classList.remove('active'));
      panels.forEach(p=>p.classList.remove('active'));
      t.classList.add('active');
      document.getElementById(t.dataset.tab).classList.add('active');
    }));

    // Breathing rhythm game
    const circle = document.getElementById('circle');
    const startBtn = document.getElementById('start');
    const stopBtn = document.getElementById('stop');
    const tapBtn = document.getElementById('tap');
    const stateEl = document.getElementById('state');
    const cycleEl = document.getElementById('cycle');
    const scoreEl = document.getElementById('score');
    const fb = document.getElementById('feedback');

    const phases = [
      {name:'Inhale', dur:4000, scale:1.15},
      {name:'Hold', dur:7000, scale:1.15},
      {name:'Exhale', dur:8000, scale:0.8}
    ];

    let running=false, cycle=0, score=0, phaseIdx=0, phaseStart=0, tapped=false, rafId=null;
    const targetWindow = 600; // ms window for a perfect tap

    function setState(name){ stateEl.textContent = name; }
    function setCycle(){ cycleEl.textContent = cycle + '/6'; }
    function setScore(){ scoreEl.textContent = score + ' pts'; }

    function phaseChange(){
      // Animate circle to target scale (CSS transition)
      circle.style.transform = `scale(${phases[phaseIdx].scale})`;
      setState(phases[phaseIdx].name);
      tapped=false;
      phaseStart = performance.now();
    }

    function loop(ts){
      if(!running) return;
      const elapsed = ts - phaseStart;
      if(elapsed >= phases[phaseIdx].dur){
        // next phase
        phaseIdx = (phaseIdx+1)%phases.length;
        if(phaseIdx===0){
          cycle++;
          setCycle();
          if(cycle>=6){ endGame(); return; }
        }
        phaseChange();
      }
      rafId = requestAnimationFrame(loop);
    }

    function startGame(){
      running=true; cycle=0; score=0; phaseIdx=0; setCycle(); setScore(); fb.style.display='none';
      phaseStart = performance.now();
      phaseChange();
      rafId = requestAnimationFrame(loop);
    }

    function endGame(){
      running=false; cancelAnimationFrame(rafId); setState('Done');
      fb.style.display='block';
      fb.className = 'badge';
      fb.textContent = score>=400 ? 'Great control! üéâ' : score>=200 ? 'Nice pacing! ‚ú®' : 'Keep practicing üå¨Ô∏è';
    }

    function stopGame(){ running=false; cancelAnimationFrame(rafId); setState('Stopped'); }

    function tap(){
      if(!running || tapped) return;
      const delta = Math.abs(performance.now() - phaseStart);
      tapped = true;
      let gained = 0;
      if(delta <= targetWindow) gained = 100; else if(delta <= 1200) gained = 50;
      score += gained;
      setScore();
      fb.style.display='block';
      fb.className = 'badge ' + (gained>=100? 'good' : 'warn');
      fb.textContent = gained? (`On time (+${gained})`) : 'Too early/late';
    }

    startBtn.addEventListener('click', startGame);
    stopBtn.addEventListener('click', stopGame);
    tapBtn.addEventListener('click', tap);

    // Future: send best score to backend profile
    // fetch('/api/game/score', {method:'POST', body: JSON.stringify({score})})
  </script>
</body>
</html>
