<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard (Mock)</title>
  <style>
    :root{--bg:#f6f8ff;--card:#fff;--ink:#0f2238;--muted:#58708d;--primary:#6c7bff;--p2:#9b8cff;--shadow:0 10px 30px rgba(15,34,56,.08);--radius:14px}
    html,body{margin:0;color:var(--ink);font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial}
    body{background:linear-gradient(180deg,#f6f8ff,#fff)}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:0 20px}
    header{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.7);backdrop-filter: blur(10px);border-bottom:1px solid #eef2ff}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
  .logo{width:36px;height:36px;border-radius:10px;background:url('https://i.ibb.co/jStfNMs/Soulence-logo.jpg') center/cover no-repeat,linear-gradient(135deg,var(--primary),var(--p2));box-shadow:var(--shadow)}
    nav ul{display:flex;gap:14px;list-style:none;margin:0;padding:0}
    nav a{padding:8px 12px;border-radius:10px;color:var(--muted)}
    nav a:hover, nav a.active{background:#eef2ff;color:var(--ink)}

    .grid{display:grid;grid-template-columns:2fr 1fr;gap:18px;margin:22px 0}
    .card{background:var(--card);border:1px solid #eef2ff;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}

    .bars{display:flex;align-items:flex-end;gap:12px;height:200px;background:#fff;border:1px dashed #e5e7eb;border-radius:12px;padding:12px}
    .b{width:28px;border-radius:10px 10px 0 0;background:linear-gradient(180deg,#c7d2fe,#6c7bff)}

    .donut{width:220px;height:220px;border-radius:50%;background:
      conic-gradient(#6c7bff 0 40%,#22c55e 0 70%,#f59e0b 0 90%,#ef4444 0 100%);
      display:grid;place-items:center;position:relative;margin:auto}
    .donut::after{content:'';position:absolute;width:150px;height:150px;border-radius:50%;background:#fff}
    .legend{display:grid;gap:6px}
    .leg{display:flex;align-items:center;gap:8px}
    .sw{width:12px;height:12px;border-radius:3px}

    @media(max-width: 1000px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
  <div class="brand"><div class="logo"></div><span>Soulence</span></div>
      <nav aria-label="Primary">
        <ul>
          <li><a href="/supervisor/home/">Home</a></li>
          <li><a class="active" href="/dashboard/">Dashboard</a></li>
          <li><a href="/supervisor/counsellor/">Counsellor</a></li>
          <li><a href="/supervisor/appointments/">Appointments</a></li>
          <li><a href="/supervisor/students/">Student Details</a></li>
          <li><a href="/logout/" style="color:#fff;background:linear-gradient(135deg,#6c7bff,#9b8cff);padding:8px 14px;">Logout</a></li>
        </ul>
      </nav>
    </div>
  </header>


  <main class="container grid">
    <section class="card" style="grid-column:1/-1">
      <h2 style="margin:0 0 8px">Mood Distribution</h2>
      <form method="get" style="margin-bottom:12px;display:inline-block">
        <label for="range" style="font-weight:600;margin-right:8px">Stats for:</label>
        <select name="range" id="range" onchange="this.form.submit()" style="padding:6px 12px;border-radius:8px;border:1px solid #e5e7eb">
          <option value="today" {% if time_filter == 'today' %}selected{% endif %}>Today</option>
          <option value="weekly" {% if time_filter == 'weekly' %}selected{% endif %}>This Week</option>
          <option value="monthly" {% if time_filter == 'monthly' %}selected{% endif %}>This Month</option>
        </select>
      </form>
      <div style="display:flex;align-items:center;gap:32px;flex-wrap:wrap">
        <div style="display:flex;flex-direction:column;align-items:center;gap:8px">
          <div style="margin-bottom:8px">
            <button type="button" class="btn" id="toggleChart" style="padding:6px 16px;font-size:15px">Switch to Bar Chart</button>
          </div>
          <canvas id="moodChart" width="260" height="220" style="max-width:260px;max-height:220px;"></canvas>
        </div>
        <div class="legend" style="margin-top:10px">
          {% for m in mood_stats %}
            <div class="leg"><span class="sw" style="background:{{ m.color }}"></span> Mood {{ forloop.counter }} {{ m.emoji }} ({{ m.percent }}%)</div>
          {% endfor %}
        </div>
      </div>
    </section>

    <section class="card">
      <h2 style="margin:0 0 8px">Weekly Activity</h2>
      <div class="bars" id="bars"></div>
      <small style="color:var(--muted)">Messages sent, resources viewed, games played.</small>
    </section>

    <section class="card" style="grid-column:1/-1">
      <h2 style="margin:0 0 8px">Trends & Notes</h2>
      <p style="margin:0;color:var(--muted)">Anonymized insights will appear here. For production, aggregate client-side data and send only aggregated metrics.</p>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Mood Chart Toggle (Pie <-> Horizontal Bar)
    const moodStats = {{ mood_stats|safe }};
    // Add emoji mapping for Mood 1-5
    const moodEmojis = ['ðŸ˜ƒ','ðŸ™‚','ðŸ˜','ðŸ˜•','ðŸ˜¢'];
    moodStats.forEach((m,i)=>m.emoji = moodEmojis[i]||'');
    let chartType = 'pie';
    const ctx = document.getElementById('moodChart').getContext('2d');
    let chart = null;
    function renderChart(type) {
      if(chart) chart.destroy();
      if(type==='pie') {
        chart = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: moodStats.map((m,i)=>`Mood ${i+1} ${m.emoji}`),
            datasets: [{
              data: moodStats.map(m=>m.count),
              backgroundColor: moodStats.map(m=>m.color),
            }]
          },
          options: {plugins:{legend:{display:false}}}
        });
        document.getElementById('toggleChart').textContent = 'Switch to Bar Chart';
      } else {
        chart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: moodStats.map((m,i)=>`Mood ${i+1} ${m.emoji}`),
            datasets: [{
              data: moodStats.map(m=>m.count),
              backgroundColor: moodStats.map(m=>m.color),
              borderRadius: 10,
              barPercentage: 0.7,
              categoryPercentage: 0.7
            }]
          },
          options: {
            indexAxis: 'y',
            plugins:{legend:{display:false}},
            scales:{x:{beginAtZero:true,grid:{display:false}},y:{grid:{display:false}}}
          }
        });
        document.getElementById('toggleChart').textContent = 'Switch to Pie Chart';
      }
    }
    renderChart(chartType);
    document.getElementById('toggleChart').onclick = function(){
      chartType = chartType==='pie' ? 'bar' : 'pie';
      renderChart(chartType);
    };

    // Weekly Activity (dummy)
    const data = [18,26,22,30,15,28,35];
    const bars = document.getElementById('bars');
    data.forEach(v=>{
      const b = document.createElement('div');
      b.className='b';
      b.style.height = (v*4)+'px';
      b.title = v+' actions';
      bars.appendChild(b);
    });
  </script>
</body>
</html>
